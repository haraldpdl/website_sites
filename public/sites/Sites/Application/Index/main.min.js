"use strict";OSCOM.a.Index.isGettingListing=!1,OSCOM.a.Index.listingCurrentPage=1,OSCOM.a.Index.siteCounter=0,OSCOM.a.Index.loadMoreUrlParams={RPC:""},$.extend(OSCOM.a.Index.loadMoreUrlParams,OSCOM.urlBaseReq,{Index:"",GetListing:""}),OSCOM.categoryPath.forEach(function(e){OSCOM.a.Index.loadMoreUrlParams[e]=""}),OSCOM.country.length>0&&(OSCOM.a.Index.loadMoreUrlParams.country=OSCOM.country),OSCOM.a.Index.showListing=function(e){if(OSCOM.a.Index.isGettingListing===!0)return!1;OSCOM.a.Index.isGettingListing=!0,toastr.clear();var t=void 0!==e?e:OSCOM.a.Index.listingCurrentPage,r=$.Deferred(),o={};OSCOM.country.length>0&&(o.country=OSCOM.country),t>1&&(OSCOM.a.Index.loadMoreUrlParams.page=t);var a=$.getJSON(OSCOM.generateUrl(!1,OSCOM.a.Index.loadMoreUrlParams),function(a){if(null===a||"object"!=typeof a||$.isArray(a)===!1)return r.reject();$("#loadMoreSpinner").removeClass("is-active"),void 0!==e&&$("#liveSitesGrid > div").filter(function(){return $(this).data("page")>=e}).remove();var i=$("#cardTemplate").html();Mustache.parse(i),a.forEach(function(e){var r=e.parent_category_name;null!==r&&(r=r.replace(/ /g,"-"));var a=e.category_name;a=a.replace(/ /g,"-"),null===r&&(e.parent_category_name=e.category_name,r=a);var n={};n[r]="";var l={};l[a]="";var d={id:OSCOM.a.Index.siteCounter,publicId:e.public_id,pageSet:t,colorClass:"mdl-color--"+OSCOM.getCardBackgroundColor(e.title),title:e.title,url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.public_id})),img_src:OSCOM.siteImagePreviewBase+e.round_id+"/"+e.public_id+".png",parent_category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,n,o)),parent_category_name:e.parent_category_name,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,n,l,o)),category_name:e.category_name,country_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{country:e.country_code})),country_name:e.country_name,total_likes:e.total_likes,lang_in_country:OSCOM.def.js_site_card_in_country,lang_admin_disable:OSCOM.def.js_site_card_admin_disable,lang_admin_requeue:OSCOM.def.js_site_card_admin_requeue};$("#liveSitesGrid").append(Mustache.render(i,d)),OSCOM.loggedIn&&OSCOM.isAdmin&&$("#c"+OSCOM.a.Index.siteCounter+" .osc-card-admin").show(),componentHandler.upgradeElements($("#c"+OSCOM.a.Index.siteCounter).get(0)),OSCOM.a.Index.siteCounter+=1}),24===a.length&&$("#loadMoreButton").show(),void 0!==e?OSCOM.a.Index.listingCurrentPage=e+1:OSCOM.a.Index.listingCurrentPage+=1,r.resolve()}).fail(function(){r.reject()});setTimeout(function(){"pending"===a.state()&&a.abort()},1e4),$.when(r).then(function(){OSCOM.a.Index.isGettingListing=!1},function(){OSCOM.a.Index.isGettingListing=!1,$("#loadMoreSpinner").removeClass("is-active"),toastr.error(OSCOM.def.js_error_general);var e=$("#liveSitesGrid > div[data-page]").map(function(){return parseInt($(this).data("page"),10)}).get();if(e.length<1)$("#loadMoreButton").show();else{var t=Math.max.apply(Math,e);24===$('#liveSitesGrid > div[data-page="'+t+'"]').length&&$("#loadMoreButton").show()}})},$("#loadMoreButton").click(function(){$("#loadMoreButton").hide(),$("#loadMoreSpinner").addClass("is-active"),OSCOM.a.Index.showListing()}),$(function(){OSCOM.a.Index.showListing()}),$("#dialogModerateSite").appendTo("body"),OSCOM.a.Index.dialogModerateSite=$("#dialogModerateSite").get(0),OSCOM.a.Index.dialogModerateSite.showModal||dialogPolyfill.registerDialog(OSCOM.a.Index.dialogModerateSite),OSCOM.a.Index.showModerateSiteDialog=function(e,t,r){if(OSCOM.loggedIn!==!0){var o=$.extend({},OSCOM.urlBaseReq);return $.extend(o,{Account:"",Login:""}),OSCOM.categoryPath.length>0&&$.extend(o,{category:OSCOM.categoryPath.join("--")}),OSCOM.country.length>0&&$.extend(o,{country:OSCOM.country}),r>0&&$.extend(o,{page:r}),window.location.href=OSCOM.generateUrl(!1,o),!1}if(OSCOM.isAdmin!==!0)return window.location.href=OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq)),!1;$("#dialogModerateSite .osc-dialog-content").hide(),$("#dialogModerateSite .osc-dialog-prepare").show(),$("#dialogModerateSite").removeData("publicId"),$("#dialogModerateSite .mdl-card__title").removeClass().addClass("mdl-card__title mdl-color-text--white"),$("#dialogModerateSite .mdl-card__title-text").empty(),$("#dialogModerateSite .mdl-card__media").empty(),$("#dialogModerateSiteSpinner").removeClass("is-active"),$("#dialogModerateSite .mdl-dialog__actions button").show(),OSCOM.a.Index.dialogModerateSite.showModal();var a=$.Deferred(),i={publicToken:OSCOM.secureToken,site:t},n=$.post(OSCOM.generateUrl(!1,$.extend({},{RPC:""},OSCOM.urlBaseReq,{Index:"",GetModerateSitePrerequisites:""})),i,function(e){return null===e||"object"!=typeof e?a.reject():e.hasOwnProperty("error")?a.reject(e.error):void(e.hasOwnProperty("site")?($("#dialogModerateSite").data("publicId",e.site.public_id),$("#dialogModerateSite").data("page",r),$("#dialogModerateSite .mdl-card__title").addClass("mdl-color--"+OSCOM.getCardBackgroundColor(e.site.title)),$("#dialogModerateSite .mdl-card__title-text").html(OSCOM.escapeHtml(e.site.title)),$("<a>",{href:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.site.public_id})),rel:"nofollow noopener noreferrer",target:"_blank"}).appendTo("#dialogModerateSite .mdl-card__media"),$("<img>",{src:OSCOM.siteImagePreviewBase+e.site.round_id+"/"+e.site.public_id+".png",style:"max-width: 100%"}).appendTo("#dialogModerateSite .mdl-card__media a"),a.resolve()):a.reject())},"json").fail(function(){a.reject()});setTimeout(function(){"pending"===n.state()&&n.abort()},1e4),$.when(a).then(function(){$('#dialogModerateSite .mdl-dialog__actions button:not([data-action="close"])').hide(),$('#dialogModerateSite .mdl-dialog__actions button[data-action="'+e+'"]').show(),$("#dialogModerateSite .osc-dialog-prepare").hide(),$("#dialogModerateSite .osc-dialog-content").show()},function(e){if(OSCOM.a.Index.dialogModerateSite.close(),null!==e)switch(e){case 100:toastr.error(OSCOM.def.js_error_mod_site_nonexistent);break;case 200:toastr.error(OSCOM.def.js_error_login_required);break;case 300:toastr.error(OSCOM.def.js_error_add_site_security_token_integrity,null,{escapeHtml:!1});break;default:toastr.error(OSCOM.def.js_error_general)}else toastr.error(OSCOM.def.js_error_general)})},$("#liveSitesGrid").on("click","a.dialogModerateLink",function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Index.showModerateSiteDialog($(this).data("action"),$("#c"+$(this).data("id")).data("publicId"),$("#c"+$(this).data("id")).data("page"))}),$('#dialogModerateSite .mdl-dialog__actions button[data-action="close"]').click(function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Index.dialogModerateSite.close()}),$("#dialogModerateSite").on("cancel",function(e){e.preventDefault(),$('#dialogModerateSite .mdl-dialog__actions button[data-action="close"]').click()}),$('#dialogModerateSite .mdl-dialog__actions button:not([data-action="close"])').click(function(e){e.preventDefault(),toastr.clear(),$("#dialogModerateSite .mdl-dialog__actions button").hide(),$("#dialogModerateSiteSpinner").addClass("is-active");var t=$.Deferred(),r=$(this).data("action"),o={publicToken:OSCOM.secureToken,action:r,publicId:$("#dialogModerateSite").data("publicId")},a={RPC:""};$.extend(a,OSCOM.urlBaseReq,{Index:"",Moderate:""});var i=$.post(OSCOM.generateUrl(!1,a),o,function(e){return null===e||"object"!=typeof e?t.reject():e.hasOwnProperty("error")?t.reject(e):void(e.hasOwnProperty("status")&&1===e.status?t.resolve():t.reject())},"json").fail(function(){t.reject()});setTimeout(function(){"pending"===i.state()&&i.abort()},1e4),$.when(t).then(function(){OSCOM.a.Index.dialogModerateSite.close(),OSCOM.a.Index.showListing($("#dialogModerateSite").data("page")),toastr.success(OSCOM.def.js_mod_success)},function(e){if($("#dialogModerateSiteSpinner").removeClass("is-active"),$('#dialogModerateSite .mdl-dialog__actions button[data-action="close"]').show(),$('#dialogModerateSite .mdl-dialog__actions button[data-action="'+r+'"]').show(),"undefined"!=typeof e&&e.hasOwnProperty("error"))switch(e.error){case 100:OSCOM.a.Index.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_mod_site_nonexistent);break;case 200:OSCOM.a.Index.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_login_required);break;case 300:OSCOM.a.Index.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_add_site_security_token_integrity,null,{escapeHtml:!1});break;case 400:OSCOM.a.Index.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_mod_invalid_action);break;case 500:default:toastr.error(OSCOM.def.js_error_general,null,{target:"#dialogModerateSite"})}else toastr.error(OSCOM.def.js_error_general,null,{target:"#dialogModerateSite"})})}),$("#dialog").appendTo("body"),OSCOM.a.Index.dialogSite=$("#dialog").get(0),OSCOM.a.Index.dialogSite.showModal||dialogPolyfill.registerDialog(OSCOM.a.Index.dialogSite),OSCOM.a.Index.showSiteDialog=function(){if(OSCOM.loggedIn!==!0){var e=$.extend({},OSCOM.urlBaseReq,{Account:"",Login:"",Redirect:"Add"});return OSCOM.categoryPath.length>0&&$.extend(e,{category:OSCOM.categoryPath.join("--")}),OSCOM.country.length>0&&$.extend(e,{country:OSCOM.country}),window.location.href=OSCOM.generateUrl(!1,e),!1}$("#dialog .osc-dialog-content").hide(),$("#dialog .osc-dialog-prepare").show(),$("#formAddSite .osc-error-field").css("color",""),$("#siteName").val($("#siteName").prop("defaultValue")).parent().removeClass("is-dirty"),$("#siteUrl").val($("#siteUrl").prop("defaultValue")),$("#siteCategory option:selected").prop("selected",!1),$("#siteCategory").parent().removeClass("is-dirty"),$("#siteCategory").val($("#siteCategory").find("option[selected]").val()),$("#siteCountry option:selected").prop("selected",!1),$("#siteCountry").parent().removeClass("is-dirty"),$("#siteCountry").val($("#siteCountry").find("option[selected]").val()),$("#disclaimerCheck").prop("checked",!1).parent().removeClass("is-checked"),OSCOM.a.Index.dialogSite.showModal();var t=$.Deferred();if($("#siteCountry option").length>1&&$("#siteCategory option").length>1)t.resolve();else{var r={publicToken:OSCOM.secureToken},o=$.post(OSCOM.generateUrl(!1,$.extend({},{RPC:""},OSCOM.urlBaseReq,{Index:"",GetNewSitePrerequisites:""})),r,function(e){if(null===e||"object"!=typeof e)return t.reject();if(e.hasOwnProperty("error"))return t.reject(e.error);if(e.hasOwnProperty("countries")&&e.countries.length>0&&e.hasOwnProperty("categories")&&e.categories.length>0){var r="";e.countries.forEach(function(e){r+='<option value="'+OSCOM.escapeHtml(e.code)+'">'+OSCOM.escapeHtml(e.title)+"</option>"}),$("#siteCountry").append(r);var o="";e.categories.forEach(function(e){o+='<optgroup label="'+OSCOM.escapeHtml(e.title)+'">',e.children.forEach(function(t){o+='<option value="'+OSCOM.escapeHtml(e.code)+"/"+OSCOM.escapeHtml(t.code)+'">'+OSCOM.escapeHtml(t.title)+"</option>"}),o+="</optgroup>"}),$("#siteCategory").append(o),t.resolve()}else t.reject()},"json").fail(function(){t.reject()});setTimeout(function(){"pending"===o.state()&&o.abort()},1e4)}$.when(t).then(function(){$("#dialog .osc-dialog-prepare").hide(),$("#dialog .osc-dialog-content").show()},function(e){if(OSCOM.a.Index.dialogSite.close(),null!==e)switch(e){case 100:toastr.error(OSCOM.def.js_error_daily_limit);break;case 200:toastr.error(OSCOM.def.js_error_login_required);break;case 300:toastr.error(OSCOM.def.js_error_add_site_security_token_integrity,null,{escapeHtml:!1});break;case 400:toastr.error(OSCOM.def.js_error_site_limit);break;default:toastr.error(OSCOM.def.js_error_general)}else toastr.error(OSCOM.def.js_error_general)})},$("#addSiteButton").click(function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Index.showSiteDialog()}),$("#dialogButtonClose").click(function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Index.dialogSite.close()}),$("#dialog").on("cancel",function(e){e.preventDefault(),$("#dialogButtonClose").click()}),$("#formAddSite").submit(function(e){e.preventDefault(),toastr.clear(),$("#dialogSaveSpinner").parent().find("button").hide(),$("#dialogSaveSpinner").addClass("is-active");var t=!1;if($("#siteName").val().length<1?($("#siteNameField .osc-error-field").css("color","#ff0000"),t=!0):$("#siteNameField .osc-error-field").css("color",""),/^(http|https)\:\/\/.+/.test($("#siteUrl").val())===!1?($("#siteUrlField .osc-error-field").css("color","#ff0000"),t=!0):$("#siteUrlField .osc-error-field").css("color",""),$("#siteCategory option:selected").val().length<1?($("#siteCategoryField .osc-error-field").css("color","#ff0000"),t=!0):$("#siteCategoryField .osc-error-field").css("color",""),$("#siteCountry option:selected").val().length<1?($("#siteCountryField .osc-error-field").css("color","#ff0000"),t=!0):$("#siteCountryField .osc-error-field").css("color",""),$("#disclaimerCheck").prop("checked")!==!0?($("#disclaimerCheckField .osc-error-field").css("color","#ff0000"),t=!0):$("#disclaimerCheckField .osc-error-field").css("color",""),t===!0)toastr.error(OSCOM.def.js_error_all_fields_required,null,{target:"#dialog"}),$("#dialogSaveSpinner").removeClass("is-active"),$("#dialogSaveSpinner").parent().find("button").show();else{var r=$.Deferred(),o={publicToken:OSCOM.secureToken,name:$("#siteName").val(),url:$("#siteUrl").val(),category:$("#siteCategory option:selected").val(),country:$("#siteCountry option:selected").val(),disclaimerCheck:$("#disclaimerCheck").val()},a=$.post(OSCOM.generateUrl(!1,$.extend({},{RPC:""},OSCOM.urlBaseReq,{Index:"",Add:""})),o,function(e){return null===e||"object"!=typeof e?r.reject():e.hasOwnProperty("error")?r.reject(e):void(e.hasOwnProperty("status")&&1===e.status?r.resolve():r.reject())},"json").fail(function(){r.reject()});setTimeout(function(){"pending"===a.state()&&a.abort()},1e4),$.when(r).then(function(){window.location.href=OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Account:"new-site-added"}))},function(e){if($("#dialogSaveSpinner").removeClass("is-active"),$("#dialogSaveSpinner").parent().find("button").show(),null!==e&&null!==e.error)switch(e.error){case 100:OSCOM.a.Index.dialogSite.close(),toastr.error(OSCOM.def.js_error_daily_limit);break;case 200:OSCOM.a.Index.dialogSite.close(),toastr.error(OSCOM.def.js_error_login_required);break;case 300:OSCOM.a.Index.dialogSite.close(),toastr.error(OSCOM.def.js_error_add_site_security_token_integrity,null,{escapeHtml:!1});break;case 400:$.inArray("name",e.fields)>-1&&$("#siteNameField .osc-error-field").css("color","#ff0000"),$.inArray("url",e.fields)>-1&&$("#siteUrlField .osc-error-field").css("color","#ff0000"),$.inArray("category",e.fields)>-1&&$("#siteCategoryField .osc-error-field").css("color","#ff0000"),$.inArray("country",e.fields)>-1&&$("#siteCountryField .osc-error-field").css("color","#ff0000"),$.inArray("disclaimerCheck",e.fields)>-1&&$("#disclaimerCheckField .osc-error-field").css("color","#ff0000"),toastr.error(OSCOM.def.js_error_all_fields_required,null,{target:"#dialog"});break;case 500:$("#siteUrlField .osc-error-field").css("color","#ff0000"),toastr.error(OSCOM.def.js_error_url_not_accessible,null,{target:"#dialog"});break;case 700:OSCOM.a.Index.dialogSite.close(),toastr.error(OSCOM.def.js_error_site_limit);break;default:toastr.error(OSCOM.def.js_error_add_site_general,null,{target:"#dialog"})}else toastr.error(OSCOM.def.js_error_add_site_general,null,{target:"#dialog"})})}});