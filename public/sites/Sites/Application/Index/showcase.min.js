"use strict";OSCOM.a.Index.isGettingListing=!1,OSCOM.a.Index.loadMoreUrlParams={RPC:""},$.extend(OSCOM.a.Index.loadMoreUrlParams,OSCOM.urlBaseReq,{Index:"",GetShowcaseListing:""}),"undefined"!=typeof OSCOM.a.Index.currentShowcaseCategory&&$.extend(OSCOM.a.Index.loadMoreUrlParams,{category:OSCOM.a.Index.currentShowcaseCategory}),"undefined"!=typeof OSCOM.a.Index.currentShowcasePartner&&$.extend(OSCOM.a.Index.loadMoreUrlParams,{partner:OSCOM.a.Index.currentShowcasePartner}),OSCOM.a.Index.showShowcaseListing=function(){if(OSCOM.a.Index.isGettingListing===!0)return!1;OSCOM.a.Index.isGettingListing=!0,toastr.clear();var e=$.Deferred(),r=$.getJSON(OSCOM.generateUrl(!1,OSCOM.a.Index.loadMoreUrlParams),function(r){if(null===r||"object"!=typeof r||$.isArray(r)===!1)return e.reject();$("#loadMoreSpinner").removeClass("is-active");var t=$("#cardTemplate").html();Mustache.parse(t);var a={partners:[],lang_in_country:OSCOM.def.js_site_card_in_country};r.forEach(function(e){var r={};r[e.code]="";var t={};t[e.category_code]="";var n={title:e.title,url:OSCOM.generateUrl(!1,$.extend({},{Services:""},t,r),OSCOM.urlSiteWebsite),category_title:e.category_title,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Showcase:""},t)),sites:[]};e.sites.forEach(function(e){var r=e.parent_category_name;null!==r&&(r=r.replace(/ /g,"-"));var t=e.category_name;t=t.replace(/ /g,"-"),null===r&&(e.parent_category_name=e.category_name,r=t);var a={};a[r]="";var o={};o[t]="",n.sites.push({publicId:e.public_id,colorClass:"mdl-color--"+OSCOM.getCardBackgroundColor(e.title),title:OSCOM.escapeHtml(e.title),url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.public_id})),img_src:OSCOM.siteImagePreviewBase+e.round_id+"/"+e.public_id+".png",parent_category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,a)),parent_category_name:e.parent_category_name,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,a,o)),category_name:e.category_name,country_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{country:e.country_code})),country_name:e.country_name,total_likes:e.total_likes})}),a.partners.push(n)}),$("#liveSitesShowcaseGrid").append(Mustache.render(t,a)),e.resolve()}).fail(function(){e.reject()});setTimeout(function(){"pending"===r.state()&&r.abort()},1e4),$.when(e).then(function(){OSCOM.a.Index.isGettingListing=!1},function(){OSCOM.a.Index.isGettingListing=!1,$("#loadMoreSpinner").removeClass("is-active"),toastr.error(OSCOM.def.js_error_general)})},$(function(){OSCOM.a.Index.showShowcaseListing()});