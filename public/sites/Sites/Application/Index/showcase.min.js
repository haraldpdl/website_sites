"use strict";OSCOM.a.Index.isGettingListing=!1,$(function(){"undefined"!=typeof OSCOM.a.Index.currentShowcasePartner?OSCOM.a.Index.showShowcaseListing():OSCOM.a.Index.showShowcasePartners()}),OSCOM.a.Index.showShowcaseListing=function(){if(OSCOM.a.Index.isGettingListing===!0)return!1;OSCOM.a.Index.isGettingListing=!0,toastr.clear();var e={RPC:""};$.extend(e,OSCOM.urlBaseReq,{Index:"",GetShowcaseListing:"",category:OSCOM.a.Index.currentShowcaseCategory,partner:OSCOM.a.Index.currentShowcasePartner});var t=$.Deferred(),r=$.getJSON(OSCOM.generateUrl(!1,e),function(e){if(null===e||"object"!=typeof e||Array.isArray(e.sites)===!1)return t.reject();$("#loadMoreSpinner").removeClass("is-active");var r=$("#cardSiteTemplate").html();Mustache.parse(r);var a={partner_title:e.partner_title,partner_desc:e.partner_desc,partner_url:e.partner_url,lang_visit_partner_website:OSCOM.strReplace(OSCOM.def.js_visit_partner_website,{":partner":e.partner_title}),sites:[],lang_in_country:OSCOM.def.js_site_card_in_country};e.sites.forEach(function(e){var t=e.parent_category_name;null!==t&&(t=t.replace(/ /g,"-"));var r=e.category_name;r=r.replace(/ /g,"-"),null===t&&(e.parent_category_name=e.category_name,t=r);var n={};n[t]="";var i={};i[r]="",a.sites.push({publicId:e.public_id,colorClass:"mdl-color--"+OSCOM.getCardBackgroundColor(e.title),title:e.title,url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.public_id})),img_src:OSCOM.siteImagePreviewBase+e.round_id+"/"+e.public_id+".png",parent_category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,n)),parent_category_name:e.parent_category_name,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,n,i)),category_name:e.category_name,country_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{country:e.country_code})),country_name:e.country_name,total_likes:e.total_likes})}),$("#liveSitesShowcaseGrid").append(Mustache.render(r,a)),t.resolve()}).fail(function(){t.reject()});setTimeout(function(){"pending"===r.state()&&r.abort()},1e4),$.when(t).then(function(){OSCOM.a.Index.isGettingListing=!1},function(){OSCOM.a.Index.isGettingListing=!1,$("#loadMoreSpinner").removeClass("is-active"),toastr.error(OSCOM.def.js_error_general)})},OSCOM.a.Index.showShowcasePartners=function(){if(OSCOM.a.Index.isGettingListing===!0)return!1;OSCOM.a.Index.isGettingListing=!0,toastr.clear();var e={RPC:""};$.extend(e,OSCOM.urlBaseReq,{Index:"",GetShowcasePartners:""}),"undefined"!=typeof OSCOM.a.Index.currentShowcaseCategory&&$.extend(e,{category:OSCOM.a.Index.currentShowcaseCategory});var t=$.Deferred(),r=$.getJSON(OSCOM.generateUrl(!1,e),function(e){if(null===e||"object"!=typeof e||Array.isArray(e)===!1)return t.reject();$("#loadMoreSpinner").removeClass("is-active");var r=$("#cardPartnerTemplate").html();Mustache.parse(r);var a={partners:[]};e.forEach(function(e){var t={};t[e.category_code]="";var r={};r[e.code]="";var n={code:e.code,title:e.title,url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Showcase:""},t,r)),colorClass:"mdl-color--"+OSCOM.getCardBackgroundColor(e.title),img_src:OSCOM.siteImagePreviewBase+e.site_round_id+"/"+e.site_public_id+".png",category_title:e.category_title,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Showcase:""},t)),total_sites:e.total_sites,total_sites_label:e.total_sites>1?OSCOM.def.js_sites_plural:OSCOM.def.js_sites_single};a.partners.push(n)}),$("#liveSitesShowcaseGrid").append(Mustache.render(r,a)),t.resolve()}).fail(function(){t.reject()});setTimeout(function(){"pending"===r.state()&&r.abort()},1e4),$.when(t).then(function(){OSCOM.a.Index.isGettingListing=!1},function(){OSCOM.a.Index.isGettingListing=!1,$("#loadMoreSpinner").removeClass("is-active"),toastr.error(OSCOM.def.js_error_general)})};