"use strict";OSCOM.a.Account.isGettingListing=!1,OSCOM.a.Account.siteCounter=0,OSCOM.a.Account.loadMoreUrlParams={RPC:""},$.extend(OSCOM.a.Account.loadMoreUrlParams,OSCOM.urlBaseReq,{Account:"",GetUserListing:""}),OSCOM.a.Account.showUserListing=function(){if(OSCOM.a.Account.isGettingListing===!0)return!1;OSCOM.a.Account.isGettingListing=!0,toastr.clear();var e=$.Deferred(),t=$.getJSON(OSCOM.generateUrl(!1,OSCOM.a.Account.loadMoreUrlParams),function(t){if(null===t||"object"!=typeof t||Array.isArray(t)===!1)return e.reject();$("#loadMoreSpinner").removeClass("is-active"),$("#liveSitesUserGrid > div").remove();var o=$("#cardTemplate").html();Mustache.parse(o);var a={sites:[],lang_in_country:OSCOM.def.js_site_card_in_country,lang_showcase_add:OSCOM.def.js_site_card_showcase_add,lang_showcase_remove:OSCOM.def.js_site_card_showcase_remove,lang_mod_remove:OSCOM.def.js_site_card_mod_remove,lang_no_site_submissions:OSCOM.def.js_no_site_submissions};t.forEach(function(e){var t=e.parent_category_name;null!==t&&(t=t.replace(/ /g,"-"));var o=e.category_name;o=o.replace(/ /g,"-"),null===t&&(e.parent_category_name=e.category_name,t=o);var r={};r[t]="";var i={};i[o]="";var n={id:OSCOM.a.Account.siteCounter,status_live:"3"===e.status,publicId:e.public_id,colorClass:"mdl-color--"+OSCOM.getCardBackgroundColor(e.title),title:e.title,url:"3"===e.status?OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.public_id})):!1,img_src:"3"===e.status?OSCOM.siteImagePreviewBase+e.round_id+"/"+e.public_id+".png":OSCOM.siteImagePreviewBase+"pending.png",parent_category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,r)),parent_category_name:e.parent_category_name,category_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,r,i)),category_name:e.category_name,country_url:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{country:e.country_code})),country_name:e.country_name,total_likes:e.total_likes,ambassador_showcase_flag:"1"===e.ambassador_showcase_flag};OSCOM.a.Account.siteCounter+=1,a.sites.push(n)}),$("#liveSitesUserGrid").append(Mustache.render(o,a)),$('#liveSitesUserGrid > div[data-ambassador-showcase-flag="true"]').addClass("osc-showcase-card-border"),componentHandler.upgradeElements($("#liveSitesUserGrid").get(0)),e.resolve()}).fail(function(){e.reject()});setTimeout(function(){"pending"===t.state()&&t.abort()},1e4),$.when(e).then(function(){OSCOM.a.Account.isGettingListing=!1},function(){OSCOM.a.Account.isGettingListing=!1,$("#loadMoreSpinner").removeClass("is-active"),toastr.error(OSCOM.def.js_error_general)})},$(function(){OSCOM.a.Account.showUserListing()}),$("#dialogModerateSite").appendTo("body"),OSCOM.a.Account.dialogModerateSite=$("#dialogModerateSite").get(0),OSCOM.a.Account.dialogModerateSite.showModal||dialogPolyfill.registerDialog(OSCOM.a.Account.dialogModerateSite),OSCOM.a.Account.showModerateSiteDialog=function(e,t){if(OSCOM.loggedIn!==!0){var o=$.extend({},OSCOM.urlBaseReq);return $.extend(o,{Account:"",Login:""}),window.location.href=OSCOM.generateUrl(!1,o),!1}if("ambShowcaseAdd"===e&&OSCOM.a.Account.totalAmbassadorShowcaseSites>=OSCOM.ambassadorLevel)return toastr.error(OSCOM.strReplace(OSCOM.def.js_error_mod_site_ambassador_showcase_full,{":ambassadors_url":OSCOM.generateUrl(!1,{_:"",Ambassadors:""},OSCOM.urlSiteWebsite)}),null,{escapeHtml:!1}),!1;$("#dialogModerateSite .osc-dialog-content").hide(),$("#dialogModerateSite .osc-dialog-prepare").show(),$("#dialogModerateSite").removeData("publicId"),$("#dialogModerateSite .osc-dialog-content .mdl-dialog__title").empty(),$("#dialogModerateSite .osc-dialog-content .mdl-dialog__content").empty(),$("#dialogModerateSiteSpinner").removeClass("is-active"),$("#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button").show(),OSCOM.a.Account.dialogModerateSite.showModal();var a=$.Deferred(),r={publicToken:OSCOM.secureToken,site:t},i=$.post(OSCOM.generateUrl(!1,$.extend({},{RPC:""},OSCOM.urlBaseReq,{Account:"",GetModerateSitePrerequisites:""})),r,function(e){return null===e||"object"!=typeof e?a.reject():e.hasOwnProperty("error")?a.reject(e.error):void(e.hasOwnProperty("site")?($("#dialogModerateSite").data("publicId",e.site.public_id),$("#dialogModerateSite .osc-dialog-content .mdl-dialog__title").html(OSCOM.escapeHtml(e.site.title)),"3"===e.site.status?($("<a>",{href:OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Go:e.site.public_id})),rel:"nofollow noopener noreferrer",target:"_blank"}).appendTo("#dialogModerateSite .osc-dialog-content .mdl-dialog__content"),$("<img>",{src:OSCOM.siteImagePreviewBase+e.site.round_id+"/"+e.site.public_id+".png",style:"max-width: 100%"}).appendTo("#dialogModerateSite .osc-dialog-content .mdl-dialog__content a")):$("<img>",{src:OSCOM.siteImagePreviewBase+"pending.png",style:"max-width: 100%"}).appendTo("#dialogModerateSite .osc-dialog-content .mdl-dialog__content"),a.resolve()):a.reject())},"json").fail(function(){a.reject()});setTimeout(function(){"pending"===i.state()&&i.abort()},1e4),$.when(a).then(function(){$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button:not([data-action="close"])').hide(),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button[data-action="'+e+'"]').show(),$("#dialogModerateSite .osc-dialog-prepare").hide(),$("#dialogModerateSite .osc-dialog-content").show()},function(e){if(OSCOM.a.Account.dialogModerateSite.close(),null!==e)switch(e){case 100:toastr.error(OSCOM.def.js_error_mod_site_nonexistent);break;case 200:toastr.error(OSCOM.def.js_error_login_required);break;case 300:toastr.error(OSCOM.strReplace(OSCOM.def.js_error_mod_site_security_token_integrity,{":account_url":OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Account:""}))}),null,{escapeHtml:!1});break;default:toastr.error(OSCOM.def.js_error_general)}else toastr.error(OSCOM.def.js_error_general)})},$("#liveSitesUserGrid").on("click","a.dialogModerateLink",function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Account.showModerateSiteDialog($(this).data("action"),$("#c"+$(this).data("id")).data("publicId"))}),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button[data-action="close"]').click(function(e){e.preventDefault(),toastr.clear(),OSCOM.a.Account.dialogModerateSite.close()}),$("#dialogModerateSite").on("cancel",function(e){e.preventDefault(),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button[data-action="close"]').click()}),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button:not([data-action="close"])').click(function(e){e.preventDefault(),toastr.clear(),$("#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button").hide(),$("#dialogModerateSiteSpinner").addClass("is-active");var t=$.Deferred(),o=$(this).data("action"),a={publicToken:OSCOM.secureToken,action:o,publicId:$("#dialogModerateSite").data("publicId")},r={RPC:""};$.extend(r,OSCOM.urlBaseReq,{Account:"",Moderate:""});var i=$.post(OSCOM.generateUrl(!1,r),a,function(e){return null===e||"object"!=typeof e?t.reject():e.hasOwnProperty("error")?t.reject(e):void(e.hasOwnProperty("status")&&1===e.status?t.resolve():t.reject())},"json").fail(function(){t.reject()});setTimeout(function(){"pending"===i.state()&&i.abort()},1e4),$.when(t).then(function(){OSCOM.a.Account.dialogModerateSite.close(),"ambShowcaseRemove"===o?OSCOM.a.Account.totalAmbassadorShowcaseSites-=1:"ambShowcaseAdd"===o&&(OSCOM.a.Account.totalAmbassadorShowcaseSites+=1),OSCOM.a.Account.showUserListing(),toastr.success(OSCOM.def.js_mod_success)},function(e){if($("#dialogModerateSiteSpinner").removeClass("is-active"),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button[data-action="close"]').show(),$('#dialogModerateSite .osc-dialog-content .mdl-dialog__actions button[data-action="'+o+'"]').show(),"undefined"!=typeof e&&e.hasOwnProperty("error"))switch(e.error){case 100:OSCOM.a.Account.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_mod_site_nonexistent);break;case 200:OSCOM.a.Account.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_login_required);break;case 300:OSCOM.a.Account.dialogModerateSite.close(),toastr.error(OSCOM.strReplace(OSCOM.def.js_error_mod_site_security_token_integrity,{":account_url":OSCOM.generateUrl(!1,$.extend({},OSCOM.urlBaseReq,{Account:""}))}),null,{escapeHtml:!1});break;case 400:OSCOM.a.Account.dialogModerateSite.close(),toastr.error(OSCOM.def.js_error_mod_invalid_action);break;case 500:default:toastr.error(OSCOM.def.js_error_general,null,{target:"#dialogModerateSite"})}else toastr.error(OSCOM.def.js_error_general,null,{target:"#dialogModerateSite"})})});